<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>飲食店評価アンケート</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f9f9f9;
        }
        #map {
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 20px 0;
        }
        #coordinates, #questions {
            margin: 20px;
            font-size: 18px;
        }
        .confirm-button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .confirm-button:hover {
            background-color: #0056b3;
        }
        #pac-input {
            margin-top: 10px;
            padding: 10px;
            width: 80%;
            max-width: 500px;
            font-size: 16px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #feedback {
            width: 80%;
            max-width: 500px;
            height: 100px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            resize: none;
        }
    </style>
</head>
<body>

    <h1>飲食店評価アンケート</h1>
    <input id="pac-input" class="controls" type="text" placeholder="Search for a location">
    <div id="map" style="width: 800px; height: 800px;"></div>
    <div id="coordinates">
        <p>Location Name: <span id="location-name">N/A</span></p>
        <p>Latitude: <span id="lat">N/A</span></p>
        <p>Longitude: <span id="lng">N/A</span></p>
    </div>
    <div class="form-group">
                    <label for="genre">ジャンルを選んでください:</label>
                    <select name="genre" id="genre" required>
                        <option value="sashimi">お刺身</option>
                        <option value="yakitori">焼き鳥</option>
                        <option value="okonomiyaki">お好み焼き・もんじゃ</option>
                        <option value="yakiniku">焼き肉</option>
                        <option value="nabe_shabu">鍋・しゃぶしゃぶ</option>
                        <option value="japanese">和食</option>
                        <option value="italian">イタリアン</option>
                        <option value="spanish">スペイン料理</option>
                        <option value="southeast_asian">東南アジア料理</option>
                        <option value="chinese">中華料理</option>
                        <option value="korean">韓国料理</option>
                        <option value="bar">バー</option>
                        <option value="others">その他</option>
                    </select>
                </div>    <br>
     <div class="form-group">
                    <label for="pricerange">価格帯を選んでください:</label>
                　　    <select name="price_range" id="price_range" required>
                        <option value="2000">2000円代</option>
                        <option value="3000">3000円代</option>
                        <option value="4000">4000円代</option>
                        <option value="5000">5000円代</option>
                        <option value="6000+">6000円以上</option>
                    </select>
                </div>     <br>
     <div class="form-group">
                    <label for="seat_type">席のタイプを選んでください:</label>
                　　    <select name="seat_type" id="seat_type" required>
                        <option value="koshitsu">個室あり</option>
                        <option value="nashi">個室なし</option>
                        <option value="hannkoshitsu">半個室あり</option>
                    </select>
                </div>    <br>
     <div class="form-group">
                    <label for="reservation_style">予約方法を選んでください:</label>
                　　    <select name="reservation_style" id="reservation_style" required>
                        <option value="web">Web予約</option>
                        <option value="call">電話予約</option>
                        <option value="non">予約不可</option>
                    </select>
                </div>     <br>
     <div class="form-group">
                    <label for="area">エリアを選んでください:</label>
                　　    <select name="area" id="area" required>
                        <option value="yurakucho">有楽町</option>
                        <option value="kachidoki">勝どき</option>
                        <option value="tukishima">月島</option>
                        <option value="toyosu">豊洲</option>
                    </select>
                </div>       <br>
     <div class="form-group">
                    <label for="tabaco">タバコの可否を選んでください:</label>
                　　    <select name="tabaco" id="tabaco" required>
                        <option value="no-smork">禁煙</option>
                        <option value="separete">分煙</option>
                        <option value="smaork-ok">喫煙</option>
                        <option value="humei">不明</option>
                    </select>
                </div>   <br>
     <div class="form-group">
                    <label for="spend_time">滞在可能時間を選んでください:</label>
                　　    <select name="spend_time" id="spend_time" required>
                        <option value="1h">1時間</option>
                        <option value="1.5h">1.5時間</option>
                        <option value="2h">2時間</option>
                        <option value="2.5h">2.5時間</option>
                        <option value="3h">3時間以上</option>
                        <option value="non-limit">制限なし</option>
                    </select>
                </div>          <br> 
     <div class="form-group">
                    <label for="main_alcohol">お店のメインのお酒を選んでください:</label>
                　　    <select name="main_alcohol" id="main_alcohol" required>
                        <option value="nihonshu">日本酒</option>
                        <option value="bear">ビール</option>
                        <option value="wine">ワイン</option>
                        <option value="shochu">焼酎</option>
                        <option value="wisky">ウィスキー</option>
                        <option value="haiball">ハイボール</option>
                        <option value="all">全般</option>
                    </select>
                </div>       <br>
     <div class="form-group">
                    <label for="drink">飲み放題の有無を選んでください:</label>
                　　    <select name="drink" id="drink" required>
                        <option value="ari">あり</option>
                        <option value="nashi">なし</option>
                    </select>
                </div>   <br>
     <div class="form-group">
                    <label for="close_hour">閉店時間を選んでください:</label>
                　　    <select name="close_hour" id="close_hour" required>
                        <option value="19ｈ">19時</option>
                        <option value="20ｈ">20時</option>
                        <option value="21ｈ">21時</option>
                        <option value="22ｈ">22時</option>
                        <option value="23ｈ">23時</option>
                        <option value="24ｈ">24時</option>
                        <option value="after24ｈ">24時以降</option>
                    </select>
                </div>      <br>
     <div class="form-group">
                    <label for="menue">コースの有無を選んでください:</label>
                　　    <select name="menue" id="menue" required>
                        <option value="ari-seat">あり（席だけ予約可）</option>
                        <option value="ari-nonseat">あり（席だけ予約不可）</option>
                        <option value="nashi">なし</option>
                    </select>
                </div>        <br>   
      <div class="form-group">
                    <label for="situation">シチュエーションを選んでください:</label>
                　　    <select name="situation" id="situation" required>
                        <option value="many-peop">大人数で宴会</option>
                        <option value="few-peop">少人数で宴会</option>
                        <option value="with-customer">接待</option>
                        <option value="calm">落ち着いた雰囲気</option>
                        <option value="high-sense">おしゃれな雰囲気</option>
                    </select>
                </div>        <br>                                                             
    <div id="questions">
        <p>総合評価を教えてください (1 〜 5): 
        　  <select id="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </p>
        <p>備考 (最大 500字まで):</p>
    <textarea id="feedback" maxlength="500"></textarea>
</div>
<button class="confirm-button" onclick="confirmLocation()">Confirm Location</button>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyBXALr5tF-Tj7zBalBSeX-yVEix_f35pW8",
    authDomain: "restaurant-survey-5c379.firebaseapp.com",
    databaseURL: "https://restaurant-survey-5c379-default-rtdb.firebaseio.com",
    projectId: "restaurant-survey-5c379",
    storageBucket: "restaurant-survey-5c379.appspot.com",
    messagingSenderId: "758872683752",
    appId: "1:758872683752:web:b571e9b8e11b91709e455d",
    measurementId: "G-DG43F9Q0EE"
  };
  
    // Initialize Firebase
    // const app = initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app);

    firebase.initializeApp(firebaseConfig);
  </script>

<script>
    let map;
    let marker;
    let infowindow;

    function initMap() {
        const defaultLocation = { lat: 35.665, lng: 139.781 };
        map = new google.maps.Map(document.getElementById("map"), {
            center: defaultLocation,
            zoom: 8,
        });

        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true,
        });

        infowindow = new google.maps.InfoWindow();

        const input = document.getElementById("pac-input");
        const searchBox = new google.maps.places.SearchBox(input);

        map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);

        map.addListener("bounds_changed", () => {
            searchBox.setBounds(map.getBounds());
        });

        searchBox.addListener("places_changed", () => {
            const places = searchBox.getPlaces();

            if (places.length == 0) {
                return;
            }

            marker.setVisible(false);

            const bounds = new google.maps.LatLngBounds();
            places.forEach(place => {
                if (!place.geometry || !place.geometry.location) {
                    console.log("Returned place contains no geometry");
                    return;
                }

                marker.setPosition(place.geometry.location);
                marker.setVisible(true);

                document.getElementById("location-name").textContent = place.name;
                document.getElementById("lat").textContent = place.geometry.location.lat();
                document.getElementById("lng").textContent = place.geometry.location.lng();

                if (place.geometry.viewport) {
                    bounds.union(place.geometry.viewport);
                } else {
                    bounds.extend(place.geometry.location);
                }
            });
            map.fitBounds(bounds);
        });

        google.maps.event.addListener(marker, 'dragend', function(event) {
            document.getElementById("lat").textContent = event.latLng.lat();
            document.getElementById("lng").textContent = event.latLng.lng();
        });
    }

    function confirmLocation() {
        const locationName = document.getElementById("location-name").textContent;
        const lat = document.getElementById("lat").textContent;
        const lng = document.getElementById("lng").textContent;
        const genre = document.getElementById("genre").value;
        const price_range = document.getElementById("price_range").value;
        const seat_type = document.getElementById("seat-type").value;
        const reservation_style = document.getElementById("reservation_style").value;
        const area = document.getElementById("area").value;
        const tabaco = document.getElementById("tabaco").value;
        const spend_time = document.getElementById("spend_time").value;
        const main_alcohol = document.getElementById("main_alcohol").value;
        const drink = document.getElementById("drink").value;
        const close_hour = document.getElementById("close_hour").value;
        const menue = document.getElementById("menue").value;
        const situation = document.getElementById("situation").value;
        const rating = document.getElementById("rating").value;
        const feedback = document.getElementById("feedback").value;

        const data = {
            locationName,
            latitude: lat,
            longitude: lng,
            genre,
            price_range,
            seat_type,
            reservation_style,
            area,
            tabaco,
            spend_time,
            main_alcohol,
            drink,
            close_hour,
            menue,
            situation,
            rating,
            feedback
        };

        // Send data to Firebase
        firebase.database().ref('locations').push(data)
            .then(() => {
                alert('Location data saved successfully!');
            })
            .catch((error) => {
                console.error('Error saving data:', error);
            });
    }
</script>

<!-- Replace YOUR_API_KEY with your actual Google Maps API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4Rhihf6YWisKD2VP0bh2Avwouyo4JOTI&libraries=places&callback=initMap" async defer></script>

<!-- Include Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>

</body>
</html>