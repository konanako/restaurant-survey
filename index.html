<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>飲食店評価アンケート</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f9f9f9;
        }
        #map {
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 20px 0;
        }
        #coordinates, #questions {
            margin: 20px;
            font-size: 18px;
        }
        .confirm-button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .confirm-button:hover {
            background-color: #0056b3;
        }
        #pac-input {
            margin-top: 10px;
            padding: 10px;
            width: 80%;
            max-width: 500px;
            font-size: 16px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #feedback {
            width: 80%;
            max-width: 500px;
            height: 100px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            resize: none;
        }
        .hidden {
            display: none;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            white-space: nowrap; /* Prevent line breaks */
        }
    </style>
</head>
<body>

    <h1>飲食店評価アンケート</h1>
    <input id="pac-input" class="controls" type="text" placeholder="Search for a location">
    <div id="map" style="width: 800px; height: 800px;"></div>
    <div id="coordinates" class="hidden">
        <p>Location Name: <span id="location_name">N/A</span></p>
        <p>Latitude: <span id="lat" visibility=>N/A</span></p>
        <p>Longitude: <span id="lng">N/A</span></p>
    </div>

    <div class="form-group">
                    <label for="genre">ジャンルを選んでください:</label>
                <!-- <div class="checkbox-group">
                    <label for="お刺身">
                        <input type="checkbox" id="お刺身" name="genre" value="お刺身">
                        お刺身
                    </label>
                    <label for="焼き鳥">
                        <input type="checkbox" id="焼き鳥" name="genre" value="焼き鳥">
                        焼き鳥
                    </label>
                    <label for="お好み焼き・もんじゃ">
                        <input type="checkbox" id="お好み焼き・もんじゃ" name="genre" value="お好み焼き・もんじゃ">
                        お好み焼き・もんじゃ
                    </label>
                    <label for="焼き肉">
                        <input type="checkbox" id="焼き肉" name="genre" value="焼き肉">
                        焼き肉
                    </label>
                    <label for="鍋・しゃぶしゃぶ">
                        <input type="checkbox" id="鍋・しゃぶしゃぶ" name="genre" value="鍋・しゃぶしゃぶ">
                        鍋・しゃぶしゃぶ
                    </label>
                    <label for="和食">
                        <input type="checkbox" id="和食" name="genre" value="和食">
                        和食
                    </label>
                    <label for="イタリアン">
                        <input type="checkbox" id="イタリアン" name="genre" value="イタリアン">
                        イタリアン
                    </label>
                    <label for="スペイン料理">
                        <input type="checkbox" id="スペイン料理" name="genre" value="スペイン料理">
                        スペイン料理
                    </label>
                    <label for="東南アジア料理">
                        <input type="checkbox" id="東南アジア料理" name="genre" value="東南アジア料理">
                        東南アジア料理
                    </label>
                    <label for="中華料理">
                        <input type="checkbox" id="中華料理" name="genre" value="中華料理">
                        中華料理
                    </label>
                    <label for="韓国料理">
                        <input type="checkbox" id="韓国料理" name="genre" value="韓国料理">
                        韓国料理
                    </label>
                    <label for="バー">
                        <input type="checkbox" id="バー" name="genre" value="バー">
                        バー
                    </label>
                    <label for="居酒屋">
                        <input type="checkbox" id="居酒屋" name="genre" value="居酒屋">
                        居酒屋
                    </label>
                    <label for="その他">
                        <input type="checkbox" id="その他" name="genre" value="その他">
                        その他
                    </label>
                </div> -->
                    <select name="genre" id="genre" size="1" required multiple>
                        <option value="お刺身">お刺身</option>
                        <option value="焼き鳥">焼き鳥</option>
                        <option value="お好み焼き・もんじゃ">お好み焼き・もんじゃ</option>
                        <option value="焼き肉">焼き肉</option>
                        <option value="鍋・しゃぶしゃぶ">鍋・しゃぶしゃぶ</option>
                        <option value="和食">和食</option>
                        <option value="イタリアン">イタリアン</option>
                        <option value="スペイン料理">スペイン料理</option>
                        <option value="東南アジア料理">東南アジア料理</option>
                        <option value="中華料理">中華料理</option>
                        <option value="韓国料理">韓国料理</option>
                        <option value="バー">バー</option>
                        <option value="その他">その他</option>
                    </select>
                </div>    <br>
     <div class="form-group">
                    <label for="price_range">価格帯を選んでください:</label>
                　　    <select name="price_range" id="price_range" required>
                        <option value="2000円代">2000円代</option>
                        <option value="3000円代">3000円代</option>
                        <option value="4000円代">4000円代</option>
                        <option value="5000円代">5000円代</option>
                        <option value="6000円以上">6000円以上</option>
                    </select>
                </div>     <br>
     <div class="form-group">
                    <label for="seat_type">席のタイプを選んでください:</label>
                　　    <select name="seat_type" id="seat_type" required>
                        <option value="個室あり">個室あり</option>
                        <option value="個室なし">個室なし</option>
                        <option value="半個室あり">半個室あり</option>
                    </select>
                </div>    <br>
     <div class="form-group">
                    <label for="reservation_style">予約方法を選んでください:</label>
                　　    <select name="reservation_style" id="reservation_style" required>
                        <option value="Web予約">Web予約</option>
                        <option value="電話予約">電話予約</option>
                        <option value="予約不可">予約不可</option>
                    </select>
                </div>     <br>
     <div class="form-group">
                    <label for="area">エリアを選んでください:</label>
                　　    <select name="area" id="area" required>
                        <option value="有楽町">有楽町</option>
                        <option value="勝どき">勝どき</option>
                        <option value="月島">月島</option>
                        <option value="豊洲">豊洲</option>
                    </select>
                </div>       <br>
     <div class="form-group">
                    <label for="tabaco">タバコの可否を選んでください:</label>
                　　    <select name="tabaco" id="tabaco" required>
                        <option value="禁煙">禁煙</option>
                        <option value="分煙">分煙</option>
                        <option value="喫煙">喫煙</option>
                        <option value="不明">不明</option>
                    </select>
                </div>   <br>
     <div class="form-group">
                    <label for="spend_time">滞在可能時間を選んでください:</label>
                　　    <select name="spend_time" id="spend_time" required>
                        <option value="1時間">1時間</option>
                        <option value="1.5時間">1.5時間</option>
                        <option value="2時間">2時間</option>
                        <option value="2.5時間">2.5時間</option>
                        <option value="3時間以上">3時間以上</option>
                        <option value="制限なし">制限なし</option>
                    </select>
                </div>          <br> 
     <div class="form-group">
                    <label for="main_alcohol">お店のメインのお酒を選んでください:</label>
                　　    <select name="main_alcohol" id="main_alcohol" required>
                        <option value="日本酒">日本酒</option>
                        <option value="ビール">ビール</option>
                        <option value="ワイン">ワイン</option>
                        <option value="焼酎">焼酎</option>
                        <option value="ウィスキー">ウィスキー</option>
                        <option value="ハイボール">ハイボール</option>
                        <option value="チューハイ">チューハイ</option>
                        <option value="全般">全般</option>
                    </select>
                </div>       <br>
     <div class="form-group">
                    <label for="drink">飲み放題の有無を選んでください:</label>
                　　    <select name="drink" id="drink" required>
                        <option value="あり">あり</option>
                        <option value="なし">なし</option>
                    </select>
                </div>   <br>
     <div class="form-group">
                    <label for="close_hour">閉店時間を選んでください:</label>
                　　    <select name="close_hour" id="close_hour" required>
                        <option value="19時">19時</option>
                        <option value="20時">20時</option>
                        <option value="21時">21時</option>
                        <option value="22時">22時</option>
                        <option value="23時">23時</option>
                        <option value="24時">24時</option>
                        <option value="24時以降">24時以降</option>
                    </select>
                </div>      <br>
     <div class="form-group">
                    <label for="menue">コースの有無を選んでください:</label>
                　　    <select name="menue" id="menue" required>
                        <option value="あり（席だけ予約可）">あり（席だけ予約可）</option>
                        <option value="あり（席だけ予約不可）">あり（席だけ予約不可）</option>
                        <option value="なし">なし</option>
                    </select>
                </div>        <br>   
      <div class="form-group">
                    <label for="situation">シチュエーションを選んでください:</label>
                　　    <select name="situation" id="situation" required>
                        <option value="大人数で宴会">大人数で宴会</option>
                        <option value="少人数で宴会">少人数で宴会</option>
                        <option value="接待">接待</option>
                        <option value="落ち着いた雰囲気">落ち着いた雰囲気</option>
                        <option value="おしゃれな雰囲気">おしゃれな雰囲気</option>
                    </select>
                </div>        <br>                                                             
    <div id="questions">
        <p>総合評価を教えてください (1 〜 5): 
        　  <select id="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </p>
        <p>備考 (最大 500字まで):</p>
    <textarea id="feedback" maxlength="500"></textarea>
</div>
<button class="confirm-button" onclick="confirmLocation()">Confirm Location</button>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyBXALr5tF-Tj7zBalBSeX-yVEix_f35pW8",
    authDomain: "restaurant-survey-5c379.firebaseapp.com",
    databaseURL: "https://restaurant-survey-5c379-default-rtdb.firebaseio.com",
    projectId: "restaurant-survey-5c379",
    storageBucket: "restaurant-survey-5c379.appspot.com",
    messagingSenderId: "758872683752",
    appId: "1:758872683752:web:b571e9b8e11b91709e455d",
    measurementId: "G-DG43F9Q0EE"
  };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    firebase.initializeApp(firebaseConfig);
  </script>

<script>
    let map;
    let marker;
    let infowindow;

    function initMap() {
        const defaultLocation = { lat: 35.665, lng: 139.781 };
        map = new google.maps.Map(document.getElementById("map"), {
            center: defaultLocation,
            zoom: 8,
        });

        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true,
        });

        infowindow = new google.maps.InfoWindow();

        const input = document.getElementById("pac-input");
        const searchBox = new google.maps.places.SearchBox(input);

        map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);

        map.addListener("bounds_changed", () => {
            searchBox.setBounds(map.getBounds());
        });

        searchBox.addListener("places_changed", () => {
            const places = searchBox.getPlaces();

            if (places.length == 0) {
                return;
            }
            
            marker.setVisible(false);

            const bounds = new google.maps.LatLngBounds();
            places.forEach(place => {
                if (!place.geometry || !place.geometry.location) {
                    console.log("Returned place contains no geometry");
                    return;
                }

                marker.setPosition(place.geometry.location);
                marker.setVisible(true);

             //表示を更新
                document.getElementById("location_name").textContent = place.name;
                document.getElementById("lat").textContent = place.geometry.location.lat();
                document.getElementById("lng").textContent = place.geometry.location.lng();

                if (place.geometry.viewport) {
                    bounds.union(place.geometry.viewport);
                } else {
                    bounds.extend(place.geometry.location);
                }
            });
            map.fitBounds(bounds);
        });

        google.maps.event.addListener(marker, 'dragend', function(event) {
            document.getElementById("lat").textContent = event.latLng.lat();
            document.getElementById("lng").textContent = event.latLng.lng();
        });
    }

    function confirmLocation() {
        const locationName = document.getElementById("location_name").textContent;
        const lat = document.getElementById("lat").textContent;
        const lng = document.getElementById("lng").textContent;
        const genre = document.getElementById("genre").value;
        const price_range = document.getElementById("price_range").value;
        const seat_type = document.getElementById("seat_type").value;
        const reservation_style = document.getElementById("reservation_style").value;
        const area = document.getElementById("area").value;
        const tabaco = document.getElementById("tabaco").value;
        const spend_time = document.getElementById("spend_time").value;
        const main_alcohol = document.getElementById("main_alcohol").value;
        const drink = document.getElementById("drink").value;
        const close_hour = document.getElementById("close_hour").value;
        const menue = document.getElementById("menue").value;
        const situation = document.getElementById("situation").value;
        const rating = document.getElementById("rating").value;
        const feedback = document.getElementById("feedback").value;

        const data = {
            locationName,
            latitude: lat,
            longitude: lng,
            genre,
            price_range,
            seat_type,
            reservation_style,
            area,
            tabaco,
            spend_time,
            main_alcohol,
            drink,
            close_hour,
            menue,
            situation,
            rating,
            feedback
        };

        // Send data to Firebase
        firebase.database().ref('locations').push(data)
            .then(() => {
                alert('Location data saved successfully!');
            })
            .catch((error) => {
                console.error('Error saving data:', error);
            });
    }
</script>

<!-- Replace YOUR_API_KEY with your actual Google Maps API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4Rhihf6YWisKD2VP0bh2Avwouyo4JOTI&libraries=places&callback=initMap" async defer></script>

<!-- Include Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>

</body>
</html>